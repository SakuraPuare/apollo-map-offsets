åœ°å›¾å’Œåœºæ™¯åç§»æ ¡å‡†å·¥ä½œæµ - æ–‡ä»¶ç»“æ„
==========================================

ğŸ“ å·¥ä½œç›®å½•
â”‚
â”œâ”€â”€ ğŸ“„ README.md                      å®Œæ•´æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ QUICKSTART.md                  å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ ğŸ“„ run_pipeline.py                ä¸»è¿è¡Œè„šæœ¬ï¼ˆæ¨èä½¿ç”¨ï¼‰
â”‚
â”œâ”€â”€ ğŸ”§ Pipeline è„šæœ¬
â”‚   â”œâ”€â”€ step1_calculate_offset.py     æ­¥éª¤1: è®¡ç®—åç§»é‡ï¼ˆåŒˆç‰™åˆ©ç®—æ³•ï¼‰
â”‚   â”œâ”€â”€ step2a_visualize_matching.py  æ­¥éª¤2a: åŒ¹é…å¯è§†åŒ–
â”‚   â”œâ”€â”€ step2b_visualize_obstacles.py æ­¥éª¤2b: éšœç¢ç‰©å¯è§†åŒ–
â”‚   â”œâ”€â”€ step3_apply_offset_to_map.py  æ­¥éª¤3: åº”ç”¨åç§»åˆ°åœ°å›¾
â”‚   â””â”€â”€ step4_create_scenario.py      æ­¥éª¤4: åˆ›å»ºæ–°åœºæ™¯
â”‚
â”œâ”€â”€ ğŸ“¥ input/                         è¾“å…¥æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ scenarios.json                åŸå§‹åœºæ™¯æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
â”‚   â”œâ”€â”€ data.json                     éšœç¢ç‰©æ•°æ®æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
â”‚   â””â”€â”€ base_map.bin                  åœ°å›¾æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
â”‚
â”œâ”€â”€ ğŸ“Š results/                       è®¡ç®—ç»“æœç›®å½•
â”‚   â””â”€â”€ offset_results.json           åç§»é‡å’ŒåŒ¹é…ç»“æœ
â”‚
â”œâ”€â”€ ğŸ–¼ï¸  visualizations/               å¯è§†åŒ–å›¾è¡¨ç›®å½•
â”‚   â”œâ”€â”€ 01_matching_overview.png      åŒ¹é…æ€»è§ˆï¼ˆ6å­å›¾ï¼‰
â”‚   â”œâ”€â”€ 02_detailed_matching.png      è¯¦ç»†åŒ¹é…è§†å›¾
â”‚   â”œâ”€â”€ 03_vector_field.png           å˜æ¢å‘é‡åœº
â”‚   â”œâ”€â”€ 04_obstacles_detailed.png     éšœç¢ç‰©è¯¦ç»†åˆ†æ
â”‚   â””â”€â”€ 05_obstacles_boxes.png        éšœç¢ç‰©è¾¹ç•Œæ¡†
â”‚
â””â”€â”€ ğŸ“¤ output/                        æœ€ç»ˆè¾“å‡ºç›®å½•
    â”œâ”€â”€ base_map_offset.bin           åç§»åçš„åœ°å›¾
    â””â”€â”€ scenarios_new.json            æ–°åœºæ™¯æ–‡ä»¶


å·¥ä½œæµç¨‹
========

Step 1: è®¡ç®—åç§»
   â”œâ”€> è¯»å– input/scenarios.json å’Œ input/data.json
   â”œâ”€> ä½¿ç”¨åŒˆç‰™åˆ©ç®—æ³•åŒ¹é…éšœç¢ç‰©
   â”œâ”€> è®¡ç®—æœ€ä¼˜åç§»é‡ï¼ˆå¹³ç§»+æ—‹è½¬ï¼‰
   â””â”€> è¾“å‡ºåˆ° results/offset_results.json

Step 2a: åŒ¹é…å¯è§†åŒ–
   â”œâ”€> è¯»å– results/offset_results.json
   â”œâ”€> ç”Ÿæˆ3å¼ åŒ¹é…åˆ†æå›¾
   â””â”€> ä¿å­˜åˆ° visualizations/01-03_*.png

Step 2b: éšœç¢ç‰©å¯è§†åŒ–
   â”œâ”€> è¯»å– input/scenarios.json å’Œ input/data.json
   â”œâ”€> è¯»å– results/offset_results.jsonï¼ˆåŒ¹é…ä¿¡æ¯ï¼‰
   â”œâ”€> ç”Ÿæˆ2å¼ éšœç¢ç‰©åˆ†æå›¾
   â””â”€> ä¿å­˜åˆ° visualizations/04-05_*.png

Step 3: åº”ç”¨åç§»åˆ°åœ°å›¾ï¼ˆå¯é€‰ï¼‰
   â”œâ”€> è¯»å– input/base_map.bin
   â”œâ”€> è¯»å– results/offset_results.json
   â”œâ”€> å¯¹æ‰€æœ‰åæ ‡ç‚¹åº”ç”¨åç§»
   â””â”€> è¾“å‡ºåˆ° output/base_map_offset.bin

Step 4: åˆ›å»ºæ–°åœºæ™¯
   â”œâ”€> è¯»å– input/scenarios.jsonï¼ˆæ¨¡æ¿ï¼‰
   â”œâ”€> è¯»å– input/data.jsonï¼ˆéšœç¢ç‰©æ•°æ®ï¼‰
   â”œâ”€> è¯»å– results/offset_results.jsonï¼ˆåŒ¹é…ä¿¡æ¯ï¼‰
   â”œâ”€> ç”Ÿæˆæ–°çš„åœºæ™¯æ–‡ä»¶ï¼ˆè¿ç»­IDï¼‰
   â””â”€> è¾“å‡ºåˆ° output/scenarios_new.json


å¿«é€Ÿä½¿ç”¨
========

ä¸€é”®è¿è¡Œï¼ˆæ¨èï¼‰:
  $ python3 run_pipeline.py

åˆ†æ­¥è¿è¡Œ:
  $ python3 step1_calculate_offset.py
  $ python3 step2a_visualize_matching.py
  $ python3 step2b_visualize_obstacles.py
  $ python3 step3_apply_offset_to_map.py input/base_map.bin output/base_map_offset.bin --format binary
  $ python3 step4_create_scenario.py -o output/scenarios_new.json


è¾“å‡ºè¯´æ˜
========

results/offset_results.json:
  - transformation: å˜æ¢å‚æ•°ï¼ˆå¹³ç§»ã€æ—‹è½¬ï¼‰
  - accuracy: ç²¾åº¦ç»Ÿè®¡ï¼ˆå¹³å‡è¯¯å·®ã€æ ‡å‡†å·®ï¼‰
  - matched_pairs: æ‰€æœ‰åŒ¹é…å¯¹è¯¦æƒ…
  - simple_offset_stats: ç®€å•å¹³ç§»ç»Ÿè®¡

visualizations/*.png:
  - é«˜åˆ†è¾¨ç‡ï¼ˆ300 DPIï¼‰å¯è§†åŒ–å›¾è¡¨
  - ç”¨äºéªŒè¯åŒ¹é…è´¨é‡å’Œåç§»è®¡ç®—ç»“æœ

output/scenarios_new.json:
  - OpenSCENARIO æ ¼å¼
  - è¿ç»­çš„éšœç¢ç‰© IDï¼ˆ1, 2, 3...ï¼‰
  - ç»Ÿä¸€çš„å‘½åè§„åˆ™ï¼ˆvehicle_*, object_*ï¼‰
  - åŸå§‹ ID ä¿å­˜åœ¨ properties ä¸­

output/base_map_offset.bin:
  - Apollo HD Map æ ¼å¼
  - æ‰€æœ‰åæ ‡ç‚¹å·²åº”ç”¨åç§»
  - ä¿æŒåŸæœ‰åœ°å›¾ç»“æ„


æŠ€æœ¯ç»†èŠ‚
========

ç®—æ³•: åŒˆç‰™åˆ©ç®—æ³•ï¼ˆHungarian Algorithmï¼‰
åº“: scipy.optimize.linear_sum_assignment
æˆæœ¬å‡½æ•°: åæ ‡è·ç¦» + 100 Ã— å°ºå¯¸å·®å¼‚
ç²¾åº¦: å¹³å‡è¯¯å·® < 5mï¼ˆä¼˜ç§€ï¼‰

åæ ‡å˜æ¢:
  data = R Ã— scenarios + t
  å…¶ä¸­ R = æ—‹è½¬çŸ©é˜µ, t = å¹³ç§»å‘é‡
